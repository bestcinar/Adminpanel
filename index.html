<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Arial;
  background:linear-gradient(135deg,#020617,#1e293b);
  color:#e5e7eb;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
.box{
  width:100%;
  max-width:1000px;
  background:#020617;
  padding:20px;
  border-radius:18px;
  box-shadow:0 0 40px rgba(79,70,229,.3);
}
h2,h3{text-align:center}
input,button{
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:10px;
  border:none;
}
input{
  background:#020617;
  color:white;
  border:1px solid #334155;
}
button{
  background:#4f46e5;
  color:white;
  cursor:pointer;
}
.hidden{display:none}
.top{display:flex;gap:10px;margin-bottom:15px}
@media(max-width:600px){.top{flex-direction:column}}
.card{
  background:#020617;
  border:1px solid #334155;
  border-radius:12px;
  padding:12px;
  margin-top:12px;
}
.small{color:#94a3b8;font-size:12px}
footer{text-align:right;font-size:12px;color:#94a3b8;margin-top:15px}
</style>
</head>

<body>

<!-- ADMIN LOGIN -->
<div class="box" id="loginBox">
  <h2>ğŸ” Admin GiriÅŸi</h2>
  <input type="password" id="adminPass" placeholder="Admin Åifresi">
  <button onclick="adminLogin()">GiriÅŸ Yap</button>
</div>

<!-- PANEL -->
<div class="box hidden" id="panelBox">
  <h2>âš™ YÃ¶netim Paneli</h2>

  <div class="top">
    <button onclick="goRegister()">â• KayÄ±t Ol</button>
    <button onclick="goLogin()">ğŸ”‘ GiriÅŸ Yap</button>
    <button onclick="logout()">ğŸšª Ã‡Ä±kÄ±ÅŸ</button>
  </div>

  <h3>ğŸ‘¥ KayÄ±tlÄ± KullanÄ±cÄ±lar</h3>
  <div id="users"></div>

  <h3>ğŸ“œ GiriÅŸ GeÃ§miÅŸi</h3>
  <div id="history"></div>

  <footer>TasarÄ±mcÄ± : Muhammet Ã‡Ä±nar</footer>
</div>

<script>
/* ===================== AYARLAR ===================== */
const ADMIN_PASSWORD = "4575";
const SESSION_TIME = 15 * 60 * 1000; // 15 dk
const ADMIN_ROLE = "superadmin"; // superadmin | admin

/* ===================== HASH ===================== */
async function hash(text){
  const enc = new TextEncoder().encode(text);
  const buf = await crypto.subtle.digest("SHA-256", enc);
  return Array.from(new Uint8Array(buf))
    .map(b=>b.toString(16).padStart(2,"0")).join("");
}

/* ===================== SESSION ===================== */
function setSession(){
  localStorage.setItem("adminSession",
    JSON.stringify({time:Date.now(),role:ADMIN_ROLE}));
}

function checkSession(){
  const s = JSON.parse(localStorage.getItem("adminSession"));
  if(!s) return false;
  if(Date.now() - s.time > SESSION_TIME){
    localStorage.removeItem("adminSession");
    alert("Oturum sÃ¼resi doldu");
    return false;
  }
  return true;
}

/* ===================== ADMIN LOGIN ===================== */
async function adminLogin(){
  if(adminPass.value === ADMIN_PASSWORD){
    setSession();
    loginBox.classList.add("hidden");
    panelBox.classList.remove("hidden");
    loadUsers();
    loadHistory();
  }else alert("YanlÄ±ÅŸ ÅŸifre");
}

if(checkSession()){
  loginBox.classList.add("hidden");
  panelBox.classList.remove("hidden");
  loadUsers();
  loadHistory();
}

function logout(){
  localStorage.removeItem("adminSession");
  location.reload();
}

function goRegister(){location.href="/register"}
function goLogin(){location.href="/Login"}

/* ===================== USERS ===================== */
async function loadUsers(){
  const box=document.getElementById("users");
  const users=JSON.parse(localStorage.getItem("users"))||[];
  box.innerHTML="";

  if(users.length===0){
    box.innerHTML="KayÄ±tlÄ± kullanÄ±cÄ± yok";
    return;
  }

  for(let i=0;i<users.length;i++){
    const u=users[i];
    box.innerHTML+=`
      <div class="card">
        <b>Email:</b> ${u.email}<br>
        <b>Takma Ad:</b> ${u.nickname}<br>
        <b>Ä°sim:</b> ${u.name}<br>
        <b>Åifre (HASH):</b><br>
        <small class="small">${u.password}</small><br>
        ${ADMIN_ROLE==="superadmin"
          ? `<button style="background:#dc2626" onclick="deleteUser(${i})">Sil</button>`
          : `<small class="small">Silme yetkisi yok</small>`
        }
      </div>`;
  }
}

function deleteUser(i){
  if(ADMIN_ROLE!=="superadmin") return;
  if(confirm("KullanÄ±cÄ± silinsin mi?")){
    const users=JSON.parse(localStorage.getItem("users"));
    users.splice(i,1);
    localStorage.setItem("users",JSON.stringify(users));
    loadUsers();
  }
}

/* ===================== LOGIN HISTORY ===================== */
function loadHistory(){
  const box=document.getElementById("history");
  const h=JSON.parse(localStorage.getItem("loginHistory"))||[];
  box.innerHTML="";

  if(h.length===0){
    box.innerHTML="HenÃ¼z giriÅŸ yok";
    return;
  }

  h.slice().reverse().forEach(x=>{
    box.innerHTML+=`
      <div class="card">
        <b>${x.email}</b><br>
        ${x.time}<br>
        <small class="small">${x.device}</small>
      </div>`;
  });
}
</script>

</body>
</html>